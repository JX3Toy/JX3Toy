## 提示
编写好的宏保存时要注意编码，不然中文的技能名、buff名都会有问题。保存为ANSI编码，没有ANSI编码的编辑器保存为GBK、GB18030等中文编码。

## print(...)
> 日志窗口输出信息, 任意类型任意数量参数, 可以输出宏运行中变量的值，用于调试

## output(...)
> 游戏系统频道输出信息, 任意类型任意数量参数

## bigtext("信息", 持续时间, 缩放)
> 大字提醒, 游戏窗口中间输出信息, 一般用于输出重要提醒
持续时间 0.5 到 10秒之间, 缺省2秒
缩放指定字体大小 1 到 5 之间, 缺省1.5

## life()
> 自己气血百分比

## lifevalue()
> 自己当前气血值

## lifemax()
> 自己最大气血值

## tlife()
> 目标气血百分比

## tlifevalue()
> 目标当前气血值

## tlifemax()
> 目标最大气血值

## xlife(角色ID)
> 指定角色气血百分比

## xlifevalue(角色ID)
> 指定角色当前气血值

## xlifemax(角色ID)
> 指定角色最大气血值

## mana()
> 自己内力百分比

## manavalue()
> 自己当前内力值

## manamax()
> 自己最大内力值

## tmana()
> 目标内力百分比

## tmanavalue()
> 目标当前内力值

## tmanamax()
> 目标最大内力值

## xmana(角色ID)
> 指定角色内力百分比

## xmanavalue(角色ID)
> 指定角色当前内力值

## xmanamax(角色ID)
> 指定角色内力最大值

## das
> 获取自己伤害吸收盾信息，返回 伤害吸收百分比，伤害吸收数值, 没有返回 0, 0

## tdas
> 获取目标伤害吸收盾信息, 没有目标或目标没有伤害吸收盾返回 0, 0

## xdas(角色ID)
> 获取指定角色伤害吸收盾信息, 指定角色不存在或没有伤害吸收盾返回 0, 0

## tas
> 获取自己治疗吸收盾信息，返回 治疗吸收百分比，治疗吸收数值, 没有返回 0, 0

## ttas
> 获取目标治疗吸收盾信息, 没有目标或目标没有治疗吸收盾返回 0, 0

## xtas
> 获取指定角色治疗吸收盾信息, 指定角色不存在或没有治疗吸收盾返回 0, 0

## fight()
> 战斗中

## nofight()
> 没进战

## tfight()
> 目标战斗中

## tnofight()
> 目标没进战

## horse()
> 自己在马上

## nohorse()
> 自己不在马上

## thorse()
> 目标在马上

## tnohorse()
> 目标不在马上

## xhorse(角色ID)
> 指定角色在马上

## xnohorse(角色ID)
> 指定角色不在马上

## qidian()
> 自己 禅那(少林)，气点(纯阳)，剑舞层数(七秀)

## tqidian()
> 目标 禅那(少林)，气点(纯阳)，剑舞层数(七秀)

## rage()
> 自己 战意(天策), 剑气(藏剑), 怒气(苍云),狂意( 霸刀), 星运(衍天), 墨意(万花)

## trage()
> 目标 战意(天策), 剑气(藏剑), 怒气(苍云),狂意( 霸刀), 星运(衍天), 墨意(万花)

## energy()
> 自己 神机值(唐门), 刀魂(霸刀), 格挡值(苍云), 锐意(刀宗)

## tenergy()
> 目标 神机值(唐门), 刀魂(霸刀), 格挡值(苍云), 锐意(刀宗)

## qijin()
> 自己 气劲(霸刀)

## tqijin()
> 目标 气劲(霸刀)

## sun()
> 自己 日灵

## tsun()
> 目标 日灵

## moon()
> 自己 月魂

## tmoon()
> 目标 月魂

## sun_power()
> 满日

## moon_power()
> 满月

## yaoxing()
> 药性, 温性大于0， 寒性小于0

## pose("姿态名")
> 自己是否指定姿态, 姿态名: "擎刀", "擎盾"

## tpose("姿态名")
> 目标是否指定姿态

## school("门派名")
> 自己是否指定门派, 门派名: 少林, 万花, 天策, 纯阳, 七秀, 五毒, 唐门, 藏剑, 丐帮, 明教, 苍云, 长歌, 霸刀, 蓬莱, 凌雪, 衍天, 药宗, 刀宗

## tschool("门派名")
> 目标是否自定门派

## xschoolname(角色ID)
> 获取指定角色的门派名

## mount("心法名")
> 自己是否指定心法

## tmount("心法名")
> 目标是否指定心法

## xmount("心法名", 角色ID)
> 指定角色是否指定心法

## xmountname(角色ID)
> 获取指定角色的心法名

## mounttype("心法类型")
> 自己是否指定心法类型, 心法类型: "内功", "外功", "治疗", "天罗"
**天罗是外功命中会心， 内功攻击破防**

## tmounttype("心法类型")
> 目标是否指定心法类型

## state("状态")
> 自己是指定移动状态

| 状态 | 说明 |
| - | - |
| "站立" | - |
| "走路" | - |
| "跑步" | - |
| "跳跃" | - |
| "水中跳跃" | - |
| "游泳" | - |
| "水中悬浮" | - |
| "坐下" | - |
| "被击倒" | - |
| "被击退" | - |
| " 被击飞" | - |
| "眩晕" | - |
| "定身" | - |
| "锁足" | - |
| "乘坐交通工具" | - |
| "重伤" | - |
| "冲刺" | - |
| "被抓" | - |
| "滑行" | - |
| "爬起" | - |
| "滑行" | - |
| "使用轻功" | - |
| "使用轻功" | - |
| "使用轻功" | - |
| "使用轻功" | - |
| "攻击位移状态" | 使用技能僵直 |
| "被击位移状态" | 被击中僵直 |
| "技能收招状态" | - |
| "重伤位移状态" | - |
| "开始交通" | - |
| "简易飞行状态" | - |
| "简易飞行浮空状态" | - |
| "简易飞行上浮状态" | - |
| "角色闪现" | - |
| "轻功" | - |
| "轻功" | - |
| "轻功" | - |

## nostate("状态")
> 自己不是指定移动状态

## tstate("状态")
> 目标是指定状态

## tnostate("状态")
> 目标不是指定状态

## xstate("状态", 角色ID)
> 指定角色是指定状态

## xnostate("状态", 角色ID)
> 指定角色不是指定状态

## dis()
> 自己到目标技能距离, 没有目标返回0

## dis2()
> 自己到目标平面距离, 没有目标返回0

## dis3()
> 自己到目标三维距离, 没有目标返回0

## xdis(角色ID)
> 自己到指定角色技能距离, 指定角色不存在返回0

## xxdis(角色ID1， 角色ID2)
> 任意两个角色之间的技能距离

## height()
> 自己距离地面高度

## theight()
> 目标距离地面高度, 没有目标或者目标不是玩家返回0

## xheight(角色ID)
> 指定角色距离地面高度, 指定角色不存在或者不是玩家返回0

## xheight1(角色ID)
> 获取指定玩家距离天花板的高度(上方障碍物)，如果上方没有障碍物返回0
可能蓬莱会用到，判断目标上方有没有障碍物

## heightz()
> 自己和目标的高度差, 没有目标返回0

## speed(角色ID)
> 获取指定角色移动速度, 不指定角色，返回自己移动速度
2个返回值: xy移动速度, z移动速度
如果没有移动，xy速度和z速度都为0
正常情况下玩家跑速为每帧20, xy速度为320
z大于0 上升， 小于0 下降

## face()
> 自己到目标的面向角度差, 没有目标返回0
```lua
--目标在自己正面60度范围
if face() < 30 then

end
```

## tface()
> 目标到自己的面向角度差
```Lua
--自己在目标背面
if tface() > 90 then

end
```

## xxface(角色ID1， 角色ID2)
> 角色1到角色2的面向角度差

## turn(角度, 角色ID)
> 面向目标或指定角色。不是立即的，有延迟，需要立即面向用acast
```lua
--面向目标
turn()
--目标方向再左转30度, 角度范围 -180 到 180, 正数左转, 负数右转
turn(30)
--面向指定角色
turn(0, 角色ID)
```

## xdir(角色ID)
> 指定角色到自己的方位, 返回 "前" "后" "左" "右", 指定角色不存在返回 "未知方位"

## pos()
> 获取自己的位置, 返回 x, y, z

## xpos(角色ID)
> 获取指定角色的位置, 返回 x, y, z

## xxpos(角色ID1, 角色ID2)
> 获取以角色1为原点, 角色2的相对平面位置，返回 x, y
x表示角色2的前后位置, 为正角色2在角色1的前方, 为负角色2在角色1的后方
y表示角色2的左右位置，为正角色2在角色1的左侧, 为负角色2在角色1的右侧
乱天狼之类的技能可能需要这个判断目标位置

## visible()
> 自己到目标视线可达

## novisible()
> 自己到目标视线不可达

## tvisible()
> 目标到自己视线可达

## tnovisible()
> 目标到自己视线不可达

## xxvisible(角色ID1， 角色ID2)
> 角色1到角色2视线可达

## obstacle(角色ID)
> 自己到指定角色之间有动态障碍物(刀墙之类), *不是特别精确有空再测试看看*

## point(原点角色ID, 距离, 旋转角度, 源角色ID, 目标角色ID)
> 获取一个点的坐标，成功返回 x y z ，失败返回 0 0 0

| 参数 | 说明 |
| - | - |
| 原点角色ID | 以这个角色的坐标作为原点 |
| 距离 | 原点坐标平移的距离, 必须大于等于0 |
| 旋转角度 | 如果没有后两个参数, 方向是原点角色面向加这个角度, 范围-180到180 |
| 源角色ID | 和下面参数一起指明方向 |
| 目标角色ID | - |

```lua
--目标到自己的前方5尺放六合独尊
--目标位置是原点, 距离5尺, 目标到自己的方向
castxyz("六合独尊", point(tid(), 5, 0, tid(), id()))
```
## canmove(源角色ID, 目标角色ID, 移动角色ID, 距离)
> 指定角色是否能向某个方向移动指定距离, 如果没有障碍物返回真，否则返回假
> 距离需要指定0到30尺之间数值

| 参数 | 说明 |
| - | - |
| 源角色ID | 和目标角色ID一起指明方向 |
| 目标角色ID | 和源角色ID一起指定方向 |
| 移动角色ID | 指定是谁移动 |
| 距离 | 如果不指定是源角色到目标角色的距离 |

```lua
--自己到目标的方向, 自己可移动
--放突之类的冲刺技能可以判断一下
--会防止视线可达能放技能，但是会被地面的障碍物卡住，冲不到目标身旁
if canmove(id(), tid(), id()) then

end
```

## cannotmove(源角色ID, 目标角色ID, 移动角色ID, 距离)
> 指定角色不能向某个方向移动指定距离（有障碍物）

## target("类型")
> 有目标或目标是否指定类型, 类型: "npc", "player", "boss"

## notarget()
> 当前没有目标

```lua
--有目标
if target() then
end
--没有目标
if notarget() then
end
--目标是玩家
if target("player") then
end
```

## name()
> 返回自己名字

## tname("名字列表")
> 如果目标是指定名字返回真，否则返回假

## xname(角色ID)
> 返回指定角色名字

## id()
> 自己角色ID

## tid()
> 目标角色ID, 没有目标返回0

## ttid()
> 目标的目标角色ID, 没有返回0

## settar(角色ID)
> 设置当前目标为指定角色

## hatred()
> 获取当前目标仇恨, 返回 仇恨最高角色ID, 仇恨百分比, 需要打开游戏内的仇恨统计

## rela("关系")
> 自己和目标是指定关系, 关系: "自己", "友好", "敌对", "中立", "队友"

## xrela("关系", 角色ID)
> 自己和指定角色是指定关系

---

* buff名列表为 "buff名1|buff名2|buff名3" 用英文竖线分隔的多个buff名或ID
* 如果参数说明为 "buff名", 只支持单个buff
* 如果buff名重复或没名字，用ID, 为字符串形式, "12345"
* 源角色ID为可选参数，需要判断是谁造成时指定

## buff("buff名列表", 源角色ID)
> 自己有指定buff且剩余时间大于等于0秒
```Lua
--自己有指定buff, 不判断源角色
if buff("buff名") then

end
--目标有自己的指定buff
if tbuff("buff名", id()) then

end
--自己有目标的指定buff
if buff("buff名", tid()) then

end
--目标有自己的三层急曲
if tbuffsn("急曲", id()) >= 3 then

end
```

## nobuff("buff名列表", 源角色ID)
> 自己没有指定buff或剩余时间小于-0.25秒

## tbuff("buff名列表", 源角色ID)
> 目标有指定buff且剩余时间大于等于0秒

## tnobuff("buff名列表", 源角色ID)
> 目标没有指定buff或剩余时间小于-0.25秒

## bufftime("buff名", 源角色ID)
> 返回自己指定buff剩余时间, 没有指定buff返回-100

## tbufftime("buff名", 源角色ID)
> 返回目标指定buff剩余时间, 没有指定buff返回-100

## xbufftime("buff名", 角色ID, 源角色ID)
> 返回指定角色指定buff剩余时间, 指定角色不存在或没有指定buff返回-100

## buffsn("buff名", 源角色ID)
> 自己指定buff层数, 没有指定buff返回0

## tbuffsn("buff名", 源角色ID)
> 目标指定buff层数, 没有指定buff返回0

## bufflv("buff名")
> 自己指定buff等级, 没有指定buff返回0

## buffsrc("buff名")
> 获取自己指定buff的源角色ID

## tbuffsrc("buff名")
> 获取目标指定buff的源角色ID

## bufftype("buff驱散类型", "buff名")
> 获取自己指定驱散类型buff的数量和指定buff是该类型的第几个<br>
buff类型: 外功气劲, 外功不利效果, 阳性气劲, 阳性不利效果, 混元性气劲, 混元性不利效果, 阴性气劲, 阴性不利效果, 点穴, 点穴不利效果, 毒性气劲, 毒性不利效果, 蛊, 蛊不利效果, 药石, 药石不利效果, 辅助类食品, 增强类食品, 辅助类药品, 增强类药品, 宴席
```lua
--获取指定驱散类型buff数量
if bufftype("阳性不利效果|混元性不利效果|阴性不利效果|毒性不利效果") > 2 then

end
```

## tbufftype("buff驱散类型", "buff名")
> 获取目标指定驱散类型buff的数量和指定buff是该类型的第几个

## cbuff("buff名")
> 取消buff

## buffis(buffid, buff等级, "类别")
> buff是否某种类型，类型: "减速", "免减速", "锁足", "免锁足", "定身", "免定身", "眩晕", "免眩晕", "击倒", "免击倒", "免打断", "免击飞", "免推", "免拉", "免僵直", "封外功", "封阳性", "封混元", "封阴性", "封毒性", "封轻功", "缴械", "免沉默", "减疗", "禁疗", "无敌", "免外伤", "免内伤", "单次免伤", "不死", "减伤", "减外伤", "减内伤", "闪避", "减命中", "反伤", "反射", "吸收伤害", "吸收百分比", "伤害转移", "爆发", "治疗转移", "可偷取", "仇恨增减", "瞬发"
**沉默对应封外功**


## buffstate("buff类别")
> 自己buff类别信息, **可xx返回真或假，时间返回剩余时间， 效果返回 0-100 之间数值**

| 类别 | 说明 |
| - | - |
| "减速时间" |  |
| "可减速" |  |
| "锁足时间" |  |
| "免锁足时间" |  |
| "可锁足" |  |
| "定身时间" |  |
| "免定身时间" |  |
| "可定身" |  |
| "眩晕时间" |  |
| "免眩晕时间" |  |
| "可眩晕" |  |
| "击倒时间" |  |
| "免击倒时间" |  |
| "可击倒" |  |
| "可推" |  |
| "可拉" |  |
| "免僵直时间" |  |
| "可僵直" |  |
| "僵直时间" |  |
| "位移时间" |  |
| "可打断" |  |
| "沉默时间" |  |
| "免沉默时间" |  |
| "可沉默" |  |
| "封内时间" |  |
| "免封内时间" |  |
| "可封内" |  |
| "封轻功时间" |  |
| "可封轻功" |  |
| "缴械时间" |  |
| "可缴械" |  |
| "减疗时间" |  |
| "减疗效果" |  |
| "可减疗" |  |
| "禁疗时间" |  |
| "无敌时间" |  |
| "免外伤时间" |  |
| "免内伤时间" |  |
| "单次免伤" | 返回单次免伤时间和层数 |
| "不死时间" |  |
| "减伤时间" |  |
| "减伤效果" |  |
| "减外伤时间" |  |
| "减外伤效果" |  |
| "减内伤时间" |  |
| "减内伤效果" |  |
| "闪避时间" |  |
| "闪避效果" |  |
| "减命中时间" |  |
| "减命中效果" |  |
| "爆发时间" | 不精确，判断相关buff |
| "反伤时间" | 少林反弹 |
| "反伤效果" |  |
| "反射时间" | 苍云盾立 |
| "化解时间" | 伤害吸收类buff时间 |
| "化解效果" | 伤害吸收效果 |
| "治疗转移时间" |  |
| "治疗转移效果" |  |
| "伤害转移时间" |  |
| "伤害转移效果" |  |
| "仇恨增减效果" |  |
| "可平沙" |  |
| "可鸿蒙" |  |

## tbuffstate("buff类别")
> 目标buff类别信息

## xbuffstate("buff类别", 角色ID)
> 指定角色buff类别信息

## casting("技能名列表")
> 自己是否在读条, 如果不指定技能名, 在读条返回读条技能名，不在读条返回 false

## castleft()
> 读条剩余时间

## castpass()
> 已读时间

## castprog()
> 读条百分比

## casttarget()
> 获取正在读条技能的释放目标, 比如读条四象轮回, 没结束就切换了目标, 那四象轮回释放的目标并不是当前目标<br>
返回角色ID或坐标(如果读条技能是一个对指定位置释放的技能)

## tcasting("技能名列表")
> 目标是否在读条, 如果不指定技能名, 在读条返回读条技能名，不在读条返回 false

## tcastleft()
> 目标读条剩余时间

## tcastpass()
> 目标已读时间

## tcastprog()
> 目标读条百分比

## tcasttarget()
> 目标的读条目标

## xcasting("技能名列表", 角色ID)
> 指定角色是否读条, 如果不指定技能名, 在读条返回读条技能名，不在读条返回 false

## xcastleft(角色ID)
> 指定角色读条剩余时间

## xcastpass(角色ID)
> 指定角色已读时间

## xcastprog(角色ID)
> 指定角色读条百分比

## xcasttarget(角色ID)
> 指定角色的读条目标

## stopcasting()
> 中断读条、引导、蓄力技能

## cast("技能名", 是否对自己释放)
> 使用技能

## fcast("技能名", 是否对自己释放)
> 使用技能, 忽略读条

## xcast("技能名", 角色ID, 是否忽略读条)
> 对指定角色使用技能

## acast("技能名", 角度, 角色ID, 是否忽略读条)
> 面向指定角色后使用技能, 不指定角色是当前目标
> 不指定角度或角度为0是正对目标，正数是正对目标再左转指定角度，负数向右
> 第三个参数除了角色ID，也可以指定一个表表示位置, 必须为 { nX = x, nY = y } 形式
```lua
--面向当前目标使用
acast("坚壁清野")
```

## castxyz("技能名", x, y, z)
> 在指定位置使用技能

## acast2("技能名", 角色ID, 距离, 角度)
> 智能释放位移技能, 指定角色到自己方向的120度范围找一个可移动指定距离(没有障碍物)的方向使用技能，主要用来放蹑云等位移技能躲避伤害或拉开距离
第二个参数除了角色ID，也可以指定一个表表示位置, 必须为 { nX = x, nY = y } 形式
距离是指离指定角色多远才可以躲开，例如风来吴山10尺伤害，那距离至少要10尺以上
第四个参数不指定或为0，是向前移动的技能，太阴指之类向后移动的技能要指定为180, 

**判断障碍物需要大量计算，调用过多会卡。**
```lua
--远离读条风来吴山的敌人
local v = {}
v["读条风来吴山敌人"] = enemy("平面距离<10", "读条:风来吴山")
if v["读条风来吴山敌人"] ~= 0 then
    if acast2("蹑云逐月", v["读条风来吴山敌人"], 13) then
        bigtext("躲风来吴山读条")
        return
    end
    acast2("迎风回浪", v["读条风来吴山敌人"], 13, 180)
    acast2("凌霄揽胜", v["读条风来吴山敌人"], 13, -90)  --只是演示不推荐
    acast2("瑶台枕鹤", v["读条风来吴山敌人"], 13, 90)   --只是演示不推荐
end
```

## use("物品名")
> 使用物品

## cdtime("技能名")
> 技能CD剩余时间, 包括GCD和技能自身CD

## scdtime("技能名")
> 技能CD剩余时间, 不包括GCD

## cn("技能名")
> 充能技能可使用次数

## cntime("技能名", 是否全部)
> 获取技能充能剩余时间
```lua
--当次剩余时间
cntime("技能名")
--全部剩余时间
cntime("技能名", true)
```

## od("技能名")
> 透支技能可使用次数

## odtime("技能名")
> 透支剩余时间

## cdleft(冷却ID)
> 指定冷却ID的剩余时间, 冷却ID参见下表

| 冷却ID | 说明 |
| - | - |
| 16 | 大部分门派GCD 1.5秒 |
| 590 | 丐帮GCD 0.5秒 |
| 503 | 明教GCD 1秒 |
| 804 | 苍云盾技能GCD 1秒 |


## cdinterval(冷却ID)
> 指定冷却ID的间隔时间, 例如GCD 16 的间隔时间是1.5秒, 受加速影响会变短

## casttime("技能名")
> 指定技能需要的读条时间, 受加速影响

## range("技能名", 是否范围技能)
> 获取技能释放距离(包括秘籍), 不需要目标和位置的范围技能第二个参数设置为 true

## miji("技能名", "秘籍名")
> 指定秘籍是否激活

## mijiactive("技能名", "秘籍名", 是否活动)
> 激活或禁用指定秘籍

## qixue("奇穴名", 第几重)
> 自己是否有指定奇穴, 如果有重名奇穴才指定第二个参数

## tqixue("奇穴名", 第几重)
> 目标有指定奇穴

## tnoqixue("奇穴名", 第几重)
> 目标没有指定奇穴

## xqixue("奇穴名", 角色ID, 第几重)
> 指定角色有指定奇穴

## xnoqixue("奇穴名", 角色ID, 第几重)
> 指定角色没有指定奇穴

---
**lasttime系列命令需要在skill.lua中配置了才有效**

## lasttime("技能名")
> 自己上次释放指定技能到当前的时间

## lasttime2("技能名")
> 自己被释放指定技能到当前的时间

## tlasttime("技能名")
> 目标上次释放指定技能到当前的时间

## tlasttime2("技能名")
> 目标被释放指定技能到当前的时间

## xlasttime("技能名", 角色ID)
> 指定角色上次释放指定技能到当前的时间

## xlasttime2("技能名", 角色ID)
> 指定角色被释放指定技能到当前的时间

## qc("气场名", 角色ID, 主人ID)
> 指定角色周围气场, 返回: 到气场边缘距离(*在圈外是正数，在圈内是负数*), 气场剩余时间
角色ID指定在谁周围, 主人ID指定是谁的气场
气场名: 气场化三清, 气场生太极, 气场破苍穹, 气场冲阴阳, 气场凌太虚, 气场碎星辰, 气场吞日月, 气场镇山河
```lua
--自己周围自己的破苍穹, 获取距离和时间
--用距离可以判断是否在圈内
--用时间可以判断有没有 还剩多久
local pcqdist, pcqtime = qc("气场破苍穹", id(), id())
```

## qjcount()
> 气纯气剑数量

## petid()
> 五毒宠物角色ID, 衍天连局角色ID, 没有返回0

## pettid()
> 宠物目标角色ID

## nopet("宠物名")
> 没有宠物, 宠物名: "圣蝎", "风蜈", "天蛛", "灵蛇", "玉蟾", "碧蝶"
```lua
--没有任何宠物
if nopet() then
end
--没有灵蛇或天蛛
if nopet("灵蛇|天蛛") then
end
```

## pet("宠物名")
> 有宠物

## pupid()
> 唐门千机变角色ID, 没有返回0

## puptid()
> 千机变目标角色ID

## nopuppet("千机变名")
> 没有指定或任何(不指定名字)千机变, 千机变名: "机关千机变底座", "机关千机变连弩", "机关千机变重弩", "机关千机变火器"

## puppet("千机变名")
> 有指定或任何(不指定名字)千机变

## shadowcount(是否可用)
> 获取影子或飞星的数量, 可用的含义是可以使用影子对应的技能
```lua
--如果6个影子
if shadowcount() >= 6 then
end
--如果有可用的影子
if shadowcount(true) > 0 then
end
```

## shadow("条件")
> 获取符合条件的可用影子或飞星信息, 返回: 技能ID, 剩余时间, 距离, 影子角色ID, 没有符合条件的可用影子返回 0

| 条件 | 说明 |
| - | - |
| 远 | 离自己较远 |
| 进 | 离自己较近 |
| 长 | 剩余时间较长 |
| 短 | 剩余时间较短 |

```lua
--使用剩余时间较短的影子对应的技能
local YZ_SkillID = shadow("短")
if YZ_SkillID ~= 0 then
    cast(YZ_SkillID)
end
```

## dengcount()
> 魂灯数量

## lianju()
> 是否有连局, 有返回真, 没有返回假

## ljtime()
> 连局剩余时间, 没有连局返回-100

## xinlianju("角色ID")
> 指定角色是否在自己连局中, 有连局且指定角色在自己连局中返回真

## xnolianju("角色ID")
> 指定角色是否不在自己连局中, 有连局且指定角色不在自己连局中返回真

## tfangdeng()
> 对目标放灯, 形成连局

## fangdeng()
> 对自己放灯, 形成连局

## 角色查找
可使用角色查找指令查找符合条件的各种角色, 下面几个表列出了可用的条件及说明。
其中，带 **最** 字的条件要放在最后，并且只能用一个，如果放在前面，它后面的条件不会生效。

---
通用条件，可用于所有类型查找
| 条件 | 说明 |
| - | - |
| "气血<0.5" | 气血百分比小于50% |
| "气血最少" |  |
| "气血最多" |  |
| "内力<0.3" | 内力百分比小于30% |
| "内力最少" |  |
| "内力最多" |  |
| "关系:敌对" | 是敌人 |
| "有状态" |  |
| "没状态:重伤" | 没挂掉 |
| "距离<20" | 技能距离小于20尺 |
| "距离最近" |  |
| "自己距离<20" | 到自己技能距离小于20尺 |
| "平面距离<20>" | 平面距离小于20尺 |
| "角色距离<20" | 三维距离小于20尺 |
| "角度" |  |
| "视线可达" | |
| "可视自己" | 到自己视线可达 |
| "自己可视" | 自己到对象视线可达 |
| "名字:" |  |
| "buff时间:" |  |
| "我的buff时间:" |  |
| "buff层数:急曲>2" | 急曲层数大于2 |
| "我的buff层数:急曲>2" | 自己造成的急曲层数大于2 |
| "buff状态:减伤效果>40" | 减伤效果大于40% |
| "buff类型时间:阴性不利效果>1" | 有阴性不利效果类buff且时间大于1秒 |
| "目标是我" |  |
| "不是自己" |  |
| "不是目标" |  |
| "读条:四象轮回" | 正在读条四象轮回 |
| "技能释放:盾立>2" | 2秒内没放过盾立 |
| "自己连局内" |  |
| "自己连局外" |  |
| "骑马" | 在马上 |

##### 视线可达 可视自己 自己可视 区别
以 tnpc 为例, 视线可达 是目标到NPC视线可达, 可视自己 是NPC到自己视线可达, 自己可视 是自己到NPC视线可达, 如果是查找自己周围的角色, 视线可达 和 自己可视 等价

---
玩家条件，不能用于NPC, 可用于玩家和队友
| 条件 | 说明 |
| - | - |
| "内功:洗髓经" | 是指定心法 |
| "有载具" |  |
| "没载具" |  |
| "被悬赏" |  |
| "同阵营" |  |
| "可选中" |  |

---
队友特定条件
| 条件 | 说明 |
| - | - |
| "同组" | 和自己是同一个小队 |
| "不同组" | 和自己是不同小队 |

---
NPC特定条件
| 条件 | 说明 |
| - | - |
| "模板ID" |  |
| "表现ID" |  |
| "可选中" |  |
| "主人:角色ID" | 主人是指定角色 |
| "连局" | 是连局且在里面 |
| "青山共我" | 是青山共我且在里面 |

## player(...)
> 自己周围符合条件的玩家, 返回: 角色ID, 符合条件的角色数量

## enemy(...)
> 自己周围符合条件的敌对玩家

## party(...)
> 自己周围符合条件的队友

## npc(...)
> 自己周围符合条件的NPC

## tplayer(...)
> 目标周围符合条件的玩家

## tenemy(...)
> 目标周围符合条件的敌对玩家

## tparty(...)
> 目标周围符合条件的队友

## tnpc(...)
> 目标周围符合条件的NPC

## xplayer(角色ID, ...)
> 指定角色周围符合条件的玩家

## xenemy(角色ID, ...)
> 指定角色周围符合条件的敌对玩家

## xparty(角色ID, ...)
> 指定角色周围符合条件的NPC

## xnpc(角色ID, ...)
> 指定角色周围符合条件的NPC

## map("地图名")
> 是否在指定地图, 如果不指定地图名则返回当前所在的地图名

## jjc(类型)
> 不指定类型，返回当前是否在JJC，JJC类型
> 指定类型，在JJC且是指定类型返回真

| 类型 | 说明 |
| - | - |
| 0 | 2V2 |
| 1 | 3V3 |
| 2 | 5V5 |
| 3 | 大师赛2V2 |
| 4 | 大师赛3V3 |
| 5 | 大师赛5V5 |

```lua
--在JJC
if jjc() then

end
--在 2V2 JJC
if jjc(0) or jjc(3) then

end
```

## dungeon()
> 是否在副本

## battle()
> 是否在战场

## treasure()
> 是否在吃鸡

## zombie()
> 是否在李渡

## allbattle()
> 是否在所有战场，包括战场，吃鸡，李渡，JJC

## moba()
> 是否在MOBA

## jump()
> 跳跃

g_player.nJumpCount  当前是第几跳
g_player.nMaxJumpCount  总共能跳几次

## movef(启停)
> 前进
```lua
--开始前进
movef(true)
--停止前进
movef(false)
```
## moveb(启停)
> 后退

## movel(启停)
> 左平移

## mover(启停)
> 右平移

## nomove(是否禁用)
> 禁止或允许移动
```lua
--禁止移动
nomove(true)
--允许移动
nomove(false)
```
## stopmove()
> 停止所有移动

## moveto(x, y, z)
> 移动到指定坐标

## keydown(索引或快捷键名)
> 如果参数是数值, 判断指定自定义快捷键是否按下, 用来处理手动按下快捷键才执行的操作。有些逻辑脚本判断比较复杂需要手动参与，用这个命令配合实现。
如果参数是字符串, 判断指定快捷键是否按下。

| 描述 | 键名 |
|- | - |
| 前进 | MOVEFORWARD |
| 后退 | MOVEBACKWARD |
| 左转 | TURNLEFT |
| 右转 | TURNRIGHT |
| 左平移 | STRAFELEFT |
| 右平移 | STRAFERIGHT |

四个快捷栏的16个按钮对应 ACTIONBAR(x)_BUTTON(y), 比如副快捷栏的第五个按钮是 ACTIONBAR2_BUTTON5

```lua
--宏运行的比较快，有公共CD的技能想手动释放, 可以判断指定快捷键是否按下优先释放
--如果自定义快捷键1按下
if keydown(1) then
    cast("技能")
end

--也可以把技能放在指定的快捷栏, 按下就优先释放
--如果快捷栏1按钮5被按下
if keydown("ACTIONBAR1_BUTTON5") then
    cast("技能")
end
```

## gettimer("计时器名")
> 获取指定计时器从设置开始过去了多少时间, 如果没有设置过指定名字计时器，返回一个很大的值

## settimer("计时器名")
> 设置指定计时器为当前时间

## deltimer(计时器名)
> 清除指定计时器, 相当于没有设置过这个计时器

## addopt("选项名", 是否选中)
> 添加宏选项, 添加后在宏选项菜单会显示这个选项，游戏内就可以开启或关闭。
```lua
--添加一个宏选项
addopt("副本防开怪", true)
```
## getopt("选项名")
> 获取宏选项状态，开启返回真，关闭返回假。

## load("脚本路径")
> 载入脚本，一般用来载入库。脚本路径是宏文件目录下的相对路径。

## exit()
> 结束脚本当次运行, 这个命令之后的脚本不会执行。

## actionclick(动作栏索引，按钮索引)
> 点击动作栏
```lua
--点击第1排动作栏第1个按钮
actionclick(1, 1)
```

## interact("名字或模板ID")
> 交互Doodad
```lua
--吃鼎
interact("仙王蛊鼎")
```

## doodad(模板ID, 表现ID)
> 获取距离自己最近指定模板ID，表现ID(可选) 的Doodad信息, 返回 x, y, z, 平面距离, DOODAD ID
没找到返回 0, 0, 0, 0, 0

## setglobal("全局设置选项", 是否允许)
> 设置全局选项, 支持的选项: "主播模式", "自动面向"
```lua
--如果在副本，关闭自动面向
if dungeon() then
   setglobal("自动面向", false)
end

--开启主播模式
setglobal("主播模式", true)
```

## account()
> 获取账号（是登录软件的账号 0x 开头，不是游戏账号），如果你编写的宏只想自己或者朋友使用，可以用这个判断，把宏加密。

# 回调函数
> 宏由一系列回调函数组成。编写好的宏载入后，宏内的函数在条件满足时会被调用。最基本的是 Main 函数，每个宏必须有。其它回调函数是可选的。
**除了 Main 函数， 其它回调函数中有些触发非常频繁，不要在里面写过多代码，不然性能会有问题**

## Main(g_player)
> 主循环，每秒调用十几次。
g_player是自己的Player对象，预留作为扩展，如果所有宏命令都满足不了需要，可以访问底层接口。

## OnPrepare(CasterID, SkillName, SkillID, SkillLevel, TargetType, TargetID, PosY, PosZ, Frame, StartFrame, FrameCount)
> 开始读条时被调用

| 参数 | 说明 |
| - | - |
| CasterID | 释放者角色ID |
| SkillName | 技能名 |
| SkillID | 技能ID |
| SkillLevel | 技能等级 |
| TargetType | 目标类型, 2是一个位置 |
| TargetID | 如果目标类型是2，为x坐标， 否则为目标ID |
| PosY | y坐标 |
| PosZ | z坐标 |
| Frame | 读条帧数 |
| StartFrame | 开始帧 |
| FrameCount | 当前帧 |

```lua
function OnPrepare(CasterID, SkillName, SkillID, SkillLevel, TargetType, TargetID, PosY, PosZ, Frame, StartFrame, FrameCount)
	if CasterID == id() then
		if TargetType == 2 then
			print("OnPrepareXYZ->["..xname(CasterID).."] 开始读条:"..SkillName..", 技能ID:"..SkillID..", 技能等级:"..SkillLevel..", 目标位置:"..TargetID.."|"..PosY.."|"..PosZ..", 读条帧数:"..Frame..", 开始帧:"..StartFrame..", 当前帧:"..FrameCount)
		else
			print("OnPrepare->["..xname(CasterID).."] 开始读条:"..SkillName..", 技能ID:"..SkillID..", 技能等级:"..SkillLevel..", 目标ID:"..TargetID..", 读条帧数:"..Frame..", 开始帧:"..StartFrame..", 当前帧:"..FrameCount)
		end
	end
end
```


## OnChannel(CasterID, SkillName, SkillID, SkillLevel, TargetType, TargetID, PosY, PosZ, Frame, StartFrame, FrameCount)
> 开始引导时被调用(倒读条), 参数同 OnPrepare

## OnCast(CasterID, SkillName, SkillID, SkillLevel, TargetType, TargetID, PosY, PosZ, StartFrame, FrameCount)
> 释放技能时被调用, 参数含义同 OnPrepare。
瞬发技能释放过程: 按键或者宏命令使用技能 -> 发送数据到服务端 -> 服务端检查通过释放 -> 服务端通知客户端释放-> OnCast 触发
读条技能释放过程: 按键或者宏命令使用技能 -> 发送数据到服务端 -> 服务端通知客户端开始读条 -> OnPrepare 触发 -> 读条结束 -> 服务端通知客户端释放 -> OnCast 触发


## OnBuff(CharacterID, BuffName, BuffID, BuffLevel, StackNum, SkillSrcID, StartFrame, EndFrame, FrameCount)
> 自己和队友更新单个buff时被调用。

| 参数 | 说明 |
| - | - |
| CharacterID | 更新buff的角色ID |
| BuffName | buff名 |
| BuffID | buffID |
| BuffLevel | buff等级 |
| StackNum | buff层数 |
| SkillSrcID | 造成这个buff的角色ID |
| StartFrame | 开始帧 |
| EndFrame | 结束帧 |
| FrameCount| 当前帧 |

## OnBuffList(CharacterID)
> 自己和队友之外的角色，不是立即同步buff。当选中时，每秒同步一次buff列表。

| 参数 | 说明 |
| - | - |
| CharacterID | 更新buff列表的角色ID |

## OnQidianUpdate()
> 自己的气点、禅那更新时被调用。

## OnStateUpdate(nCurrentLife, nCurrentMana, nCurrentRage, nCurrentEnergy, nCurrentSunEnergy, nCurrentMoonEnergy)
> 自己的状态更新时被调用。

## OnFight(bFight)
> 进战或脱战时被调用，进战 bFight 为 true，否则为 false
```lua
function OnFight(bFight)
    if bFight then
        print("进战")
        settimer("战斗计时器")
    else
        print("脱战")
    end
end
```

## OnNpcEnter(NpcID, NpcName, NpcTemplateID, NpcModelID, EmployerID)
> NPC出现时被调用。

| 参数 | 说明 |
| - | - |
| NpcID | NPC角色ID |
| NpcName | 名字 |
| NpcTemplateID | 模板ID |
| NpcModelID | 表现ID |
| EmployerID | 主人角色ID |

## OnMountKungFu(KungFu, Level)
> 自己切换心法时被调用。

## OnMessage(szMsg, szType)
> 显示系统聊天信息时被调用。

## OnSay(Name, SayText, CharacterID)
> NPC喊话时被调用。

## OnWarning(szText, szType)
> 显示警告信息时被调用。
